{"version":3,"sources":["scripts/app-d2e33029fa.js"],"names":["angular","module","SubmitSimulationService","$resource","$log","submit","targetURL","parameters","callback","poster","send","method","submited","$promise","then","service","$inject","SimForm","directive","templateUrl","currentScriptPath","replace","scope","schemaurl","controller","controllerAs","bindToController","scripts","document","getElementsByTagName","length","src","SchemaService","addCustomTypeHandler","type","handler","customTypes","getSchema","schemaURL","schema","request","get","parseSchema","data","newSchema","properties","newForm","toJSON","forEach","item","applyRulesForItem","form","parameter","rules","name","param","paramType","typeMappings","str","number","list","customTypeFun","debug","contents","min_length","Number","max_length","default","title","description","min","max","schemaItem","formItem","key","rule","push","FormController","$scope","$timeout","onSubmit","$valid","vm","model","flashMessage","msg","message","hidden","startFade","this","_","has","$parent","widget","runBlock","run","constant","malarkey","moment","config","$logProvider","toastrConfig","debugEnabled","allowHtml","timeOut","positionClass","preventDuplicates","progressBar","$templateCache","put"],"mappings":"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","file":"scripts/app-d2e33029fa.js","sourcesContent":["\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective',\n    [\n      'ngResource',\n      'ui.bootstrap',\n      'toastr',\n      'schemaForm'\n    ]);\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .service('SubmitSimulationService', SubmitSimulationService);\n\n  function SubmitSimulationService($resource, $log) {\n    var service = {\n      submit: submit\n    };\n    return service;\n\n    function submit(targetURL, parameters, callback) {\n      var poster = $resource(targetURL, {},\n         { send: { method: 'GET' } });\n      var submited = poster.send(parameters);\n\n      if(typeof callback === 'function') {\n        return submited.$promise.then(callback);\n      } else {\n        return submited.$promise;\n      }\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  var scripts = document.getElementsByTagName(\"script\")\n  var currentScriptPath = scripts[scripts.length-1].src;\n\n  angular\n    .module('simCitySimDirective')\n    .directive('simForm', SimForm);\n\n  function SimForm() {\n    var directive = {\n        templateUrl: currentScriptPath.replace('directive.js', 'directive.html'),\n        scope: {\n            schemaurl: '@'\n        },\n        controller: 'FormController',\n        controllerAs: 'vm',\n        bindToController: true\n    };\n    return directive;\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .service('SchemaService', SchemaService);\n\n  function SchemaService($resource, $log) {\n    var customTypes = {};\n\n    var service = {\n      addCustomTypeHandler: addCustomTypeHandler,\n      getSchema: getSchema,\n    };\n    return service;\n\n    // Handler should be function(schema, form) {}\n    function addCustomTypeHandler(type, handler) {\n      customTypes[type] = handler;\n    }\n\n    function getSchema(schemaURL) {\n      var schema = $resource(schemaURL);\n      var request = schema.get();\n      return request.$promise.then(parseSchema);\n    }\n\n    function parseSchema(data) {\n      var newSchema = {\n        type: 'object',\n        properties: {}\n      };\n      var newForm   = [];\n\n      // Transform Resource object to JSON\n      data = data.toJSON();\n      data.parameters.forEach(function(item) {\n        applyRulesForItem(item, newSchema, newForm);\n      });\n\n      return {\n        schema: newSchema,\n        form:   newForm\n      };\n    }\n\n    function applyRulesForItem(parameter, schema, form) {\n      var rules = {\n        name: function(param, schema, form) {},\n        type: function(param, schema, form) {\n          var paramType = param['type'];\n          var typeMappings = {\n            'str': 'string',\n            'number': 'number',\n            'list': 'array'\n          };\n\n          if(customTypes[paramType]) {\n            var customTypeFun = customTypes[paramType];\n            customTypeFun(schema, form);\n          } else if(typeMappings[paramType]) {\n            schema['type'] = typeMappings[paramType];\n          } else {\n            $log.debug('SchemaService: no mapping known for type: ' + paramType);\n            schema['type'] = paramType;\n          }\n        },\n        contents: function(param, schema, form) {\n          schema['items'] = {\n            type: 'object',\n            properties: {}\n          };\n          form['items'] = [];\n          param['contents'].name = param['contents'].name || '_unnamed';\n          applyRulesForItem(param['contents'], schema['items'], form['items']);\n        },\n        min_length: function(param, schema, form) {\n          schema['minLength'] = Number(param['min_length']);\n        },\n        max_length: function(param, schema, form) {\n          schema['maxLength'] = Number(param['max_length']);\n        },\n        default: function(param, schema, form) {\n          if ( param['type'] === 'number' ) {\n            schema['default'] = Number(param['default']);\n          }\n        },\n        title: function(param, schema, form) {\n          schema['title'] = param['title'];\n        },\n        description: function(param, schema, form) {\n          schema['description'] = param['description'];\n        },\n        min: function(param, schema, form) {\n          form['min'] = param['min'];\n        },\n        max: function(param, schema, form) {\n          form['max'] = param['max'];\n        },\n      };\n\n      if(!('name' in parameter)) {\n        $log.debug('No name present in parameter! Cannot process further.');\n        return;\n      }\n      var name = parameter['name'];\n\n      var schemaItem = {};\n      var formItem = { key: name };\n\n      for(var key in parameter) {\n        if(key in rules) {\n          var rule = rules[key];\n          rule(parameter, schemaItem, formItem);\n        } else {\n          $log.debug('SchemaService: no rule know for key: ' + key);\n        }\n      }\n\n      schema.properties[name] = schemaItem;\n      form.push(formItem);\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .controller('FormController', FormController);\n\n  function FormController($scope, $timeout, $log, SchemaService, SubmitSimulationService) {\n    var vm = this;\n\n    vm.schema = {};\n    vm.form = [];\n    vm.model = {};\n    vm.hidden = true;\n    vm.startFade = false;\n    vm.message = '';\n\n    // Functions the controller exposes\n    vm.onSubmit = onSubmit;\n\n    // Initialize controller\n    if(_.has($scope, '$parent.widget.data.schemaurl')) {\n      vm.schemaurl = $scope.$parent.widget.data.schemaurl;\n    }\n    if(vm.schemaurl) {\n      SchemaService.getSchema(vm.schemaurl).then(\n        function(data) {\n          vm.schema = data.schema;\n          vm.form = data.form;\n        }\n      );\n    } else {\n      $log.debug('SimCityDirective.FormController: no URL provided');\n    }\n\n    function onSubmit(form) {\n      // Then we check if the form is valid\n      if (form.$valid) {\n        SubmitSimulationService.submit(vm.schemaurl,\n          vm.model, function() {\n            flashMessage('Form has been submitted!');\n          });\n      }\n    }\n\n    function flashMessage(msg) {\n      vm.message = msg;\n      vm.hidden = false;  // Show\n      vm.startFade = false;\n\n      // After 5 seconds, fade\n      $timeout(function(){\n        vm.startFade = true;\n        // and then hide\n        $timeout(function(){ vm.hidden = true; }, 500);\n      }, 2000);\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log, SchemaService) {\n    SchemaService.addCustomTypeHandler('point2d', function(schema, form) {\n      schema['items'] = { 'type': 'object' };\n      form['type'] = 'template';\n      form['template'] = '<div>Point 2D template!</div>';\n    });\n  }\n\n})();\n\n/* global malarkey:false, moment:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .constant('malarkey', malarkey)\n    .constant('moment', moment);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('simCitySimDirective')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, toastrConfig) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // Set options third-party lib\n    toastrConfig.allowHtml = true;\n    toastrConfig.timeOut = 3000;\n    toastrConfig.positionClass = 'toast-top-right';\n    toastrConfig.preventDuplicates = true;\n    toastrConfig.progressBar = true;\n  }\n\n})();\n\nangular.module(\"simCitySimDirective\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/sim-city/simform.directive.html\",\"<div><div class=\\\"alert alert-success\\\" ng-hide=\\\"vm.hidden\\\" ng-class=\\\"{fade: vm.startFade}\\\">{{ vm.message }}</div><form name=\\\"myForm\\\" sf-schema=\\\"vm.schema\\\" sf-form=\\\"vm.form\\\" sf-model=\\\"vm.model\\\" sf-options=\\\"\\\"></form><button ng-click=\\\"vm.onSubmit(myForm)\\\" class=\\\"btn btn-success\\\">Submit</button></div>\");}]);"],"sourceRoot":"/source/"}